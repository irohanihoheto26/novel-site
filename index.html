<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>小説サイト</title>
<style>
body{font-family:sans-serif;max-width:800px;margin:0 auto;padding:20px;background:#f9f9f9}
section{background:white;padding:20px;border-radius:8px;margin-bottom:20px}
input,textarea{width:100%;margin-bottom:10px;padding:10px;box-sizing:border-box}
button{background:#333;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer}
#auth-status{text-align:right;color:#666}
</style>
</head>
<body>
<div id="auth-status">準備中...</div>
<section id="auth-section">
<h2>ログイン/登録</h2>
<input type="email" id="email" placeholder="メール">
<input type="password" id="password" placeholder="パスワード">
<button onclick="signUp()">新規登録</button>
<button onclick="logIn()">ログイン</button>
</section>
<section id="post-section" style="display:none">
<h2>投稿する</h2>
<input type="text" id="title" placeholder="タイトル">
<textarea id="content" placeholder="本文" rows="10"></textarea>
<button onclick="postNovel()">投稿</button>
<button onclick="logOut()">ログアウト</button>
</section>
<div id="novel-list">読み込み中...</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL='https://fnobmngpstzolphexluc.supabase.co';
const SUPABASE_KEY='sb_publishable_wczOfUdvKuScZQJ0Lklx0w_D9XtJPqE';
const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
async function checkUser(){
try{
const {data:{user}}=await supabase.auth.getUser();
if(user){
document.getElementById('auth-section').style.display='none';
document.getElementById('post-section').style.display='block';
document.getElementById('auth-status').innerText='ログイン中:'+user.email;
}else{
document.getElementById('auth-status').innerText='未ログイン';
}
}catch(e){document.getElementById('auth-status').innerText='エラー:'+e.message}
}
async function signUp(){
try{
const e=document.getElementById('email').value;
const p=document.getElementById('password').value;
const {error}=await supabase.auth.signUp({email:e,password:p});
if(error) alert("エラー:"+error.message);
else alert("メールを送信しました！確認してください。");
}catch(err){alert("実行エラー:"+err.message)}
}
async function logIn(){
const e=document.getElementById('email').value;
const p=document.getElementById('password').value;
const {error}=await supabase.auth.signInWithPassword({email:e,password:p});
if(error) alert("エラー:"+error.message);
else location.reload();
}
async function logOut(){await supabase.auth.signOut();location.reload();}
async function postNovel(){
const t=document.getElementById('title').value;
const c=document.getElementById('content').value;
const {data:{user}}=await supabase.auth.getUser();
const {error}=await supabase.from('novels').insert([{title:t,content:c,author_id:user.id}]);
if(error) alert("失敗:"+error.message);
else {alert("投稿成功！");location.reload();}
}
async function getNovels(){
try{
const {data}=await supabase.from('novels').select('*').order('created_at',{ascending:false});
if(data) document.getElementById('novel-list').innerHTML=data.map(n=>`<div><h3>${n.title}</h3><p>${n.content}</p></div>`).join('<hr>');
}catch(e){console.error(e)}
}
checkUser();
getNovels();
</script>
</body>
</html>
